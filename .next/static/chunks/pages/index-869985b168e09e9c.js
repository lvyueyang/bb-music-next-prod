(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{74:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(2283)}])},2283:function(e,t,i){"use strict";let a,s,n;i.r(t),i.d(t,{default:function(){return iq}});var r,l,c,o,d,u,m,h,p,v,y,_,x=i(7458),g=i(850),j=i.n(g),f=i(2983),N=i(3525),b=i.n(N),C=i(2256);let k=(0,C.Ue)()((e,t)=>({theme:b().dark,setState:e}));function L(e){let{children:t,theme:i=b().dark,apiInstance:s}=e;a||(a=s);let n=k();return((0,f.useEffect)(()=>{console.log("BBMusicApp Start"),n.setState({theme:i})},[i]),(0,f.useEffect)(()=>{Promise.all(s.musicServices.map(async e=>{var t,i;return await (null===(i=e.hooks)||void 0===i?void 0:null===(t=i.init)||void 0===t?void 0:t.call(i))})).then(()=>{console.log("配置初始化完成")}).catch(e=>{console.log("配置初始化失败")})},[]),s)?(0,x.jsx)(x.Fragment,{children:t}):null}var w=i(7860),O=i.n(w),M=i(5385),S=i.n(M);function I(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.filter(e=>!!e).join(" ")}function P(e){try{return JSON.parse(e)}catch(e){}}function D(e){return O().duration(e,"seconds").format("mm:ss")}function E(e){let t=a.userMusicOrder.find(t=>t.name===e);return t||console.error("歌单源 ".concat(e," 不存在")),t}function T(e){let t=a.musicServices.find(t=>t.name===e);return t||console.error("歌曲源 ".concat(e," 服务不存在")),t}O().extend(S());var A=i(5833),F=i.n(A);let H="bb-ui";function U(e){let{type:t="default",className:i,style:a,children:s,...n}=e;return(0,x.jsx)("button",{...n,className:I(F().btn,"".concat(H,"-btn"),i,F()[t]),style:a,children:s})}var R=i(1928),Z=i(3371),B=i.n(Z),W=i(312);function V(e){let{tag:t="div",children:i,items:a=[],...s}=e,n=k((0,W.N)(e=>({theme:e.theme})));return(0,x.jsxs)(R.fC,{children:[(0,x.jsx)(R.xz,{...s,style:{...s.style,zIndex:9999},children:i}),(0,x.jsx)(R.Uv,{children:(0,x.jsx)(R.VY,{className:I(B().menu,n.theme),style:{zIndex:9999},children:a.map(e=>(0,x.jsx)(J,{item:e},e.key))})})]})}function J(e){var t;let{item:i}=e,a=k((0,W.N)(e=>({theme:e.theme})));return i.hide?null:"divider"===i.type?(0,x.jsx)(R.Z0,{className:B().divider},i.key):(null===(t=i.children)||void 0===t?void 0:t.length)?(0,x.jsxs)(R.Tr,{children:[(0,x.jsx)(R.fF,{className:B().item,children:i.label}),(0,x.jsx)(R.Uv,{children:(0,x.jsx)(R.tu,{className:I(a.theme,B().menu),sideOffset:2,alignOffset:-5,children:i.children.map(e=>(0,x.jsx)(J,{item:e},e.key))})})]}):(0,x.jsx)(R.ck,{className:B().item,onClick:i.onClick,children:i.label},i.key)}var q=i(7959),G=i.n(q);function X(e){let{label:t,children:i,className:a,style:s}=e;return(0,x.jsxs)("label",{className:I(a,G().formItem),style:s,children:[(0,x.jsx)("div",{className:"ui-form-item-label",children:t}),(0,x.jsx)("div",{className:"ui-form-item-content",children:i})]})}var z=i(3158),K=i.n(z);function Y(e){let{className:t,style:i,mode:a,src:s,alt:n,...r}=e;return(0,x.jsx)("div",{className:I(K().img,"".concat(H,"-img"),t),style:i,...r,children:(0,x.jsx)("img",{style:{objectFit:a},src:s,alt:n})})}var Q=i(4911),$=i.n(Q);function ee(e){let{className:t,style:i,type:a,...s}=e;return(0,x.jsx)("input",{...s,className:I($().input,"".concat(H,"-input"),t),style:i,type:a})}var et=i(8704),ei=i(5129),ea=i.n(ei);function es(){let[e,t]=(0,f.useState)([]);return(0,f.useEffect)(()=>{let e=(e,i)=>{let{duration:a}=i,s=Date.now().toString();t(i=>[...i,{open:!0,key:s,message:e,duration:a,onClose:()=>{t(e=>e.filter(e=>e.key!==s))}}])};s={success:t=>{e(t,{})},loading:t=>{e(t,{duration:6e5})},error:t=>{e(t,{})}}},[]),(0,x.jsxs)(et.zt,{swipeDirection:"up",children:[e.map(e=>(0,f.createElement)(en,{...e,key:e.key})),(0,x.jsx)(et.l_,{className:ea().ToastViewport})]})}function en(e){let{open:t,message:i,onClose:a,duration:s=3e3}=e;return(0,x.jsx)(et.fC,{className:ea().ToastRoot,open:t,onOpenChange:e=>{e||a()},duration:s,children:(0,x.jsx)(et.Dx,{children:i})})}var er=i(5787),el=i(3923),ec=i.n(el),eo=i(3730);let ed=!1;function eu(e){let{title:t,width:i=400,footer:a,open:s,children:n,onClose:r,onOk:l}=e,c=k();return s?(console.log("isMobileEnv: ",ed),(0,eo.createPortal)((0,x.jsx)("div",{className:I(ec().modalContainer,c.theme,ed?ec().modalContainerForMobile:""),children:(0,x.jsxs)("div",{className:ec().modal,style:{width:i},children:[(0,x.jsxs)("div",{className:ec().header,children:[(0,x.jsx)("div",{className:ec().title,children:t}),(0,x.jsx)("div",{className:ec().close,onClick:r,children:(0,x.jsx)(er.Z,{})})]}),(0,x.jsx)("div",{className:ec().body,children:n}),(0,x.jsx)("div",{className:ec().footer,children:a||(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(U,{type:"primary",onClick:async()=>{try{await (null==l?void 0:l()),null==r||r()}catch(e){console.error(e)}},children:"确定"})})})]})}),document.body)):null}var em=i(3352),eh=i.n(em),ep=i(3994);function ev(e){let{onChange:t,...i}=e;return(0,x.jsx)(ep.fC,{...i,onCheckedChange:e=>{var a;null==t||t(e),null===(a=i.onCheckedChange)||void 0===a||a.call(i,e)},className:I(eh().SwitchRoot,i.className),children:(0,x.jsx)(ep.bU,{className:eh().SwitchThumb})})}var ey=i(6133),e_=i.n(ey);function ex(e){let{className:t,style:i,...a}=e;return(0,x.jsx)("table",{...a,className:I(e_().table,"".concat(H,"-table"),t)})}var eg=i(8389),ej=i(6916),ef=i.n(ej);let eN=e=>{let{children:t,content:i,asChild:a,contentProps:s,arrowColor:n,...r}=e,{theme:l}=k((0,W.N)(e=>({theme:e.theme})));return(0,x.jsxs)(eg.fC,{...r,children:[(0,x.jsx)(eg.xz,{asChild:a,children:t}),(0,x.jsx)(eg.h_,{children:(0,x.jsxs)(eg.VY,{...s,sideOffset:5,className:I(l,ef().PopoverContent,null==s?void 0:s.className),children:[(0,x.jsx)(x.Fragment,{children:i}),(0,x.jsx)(eg.Eh,{className:ef().Arrow,style:{fill:n}})]})})]})};var eb=i(5452),eC=i(4670),ek=i.n(eC);let eL=e=>{let{...t}=e;return(0,x.jsxs)(eb.fC,{...t,className:I(ek().SliderRoot,t.className),children:[(0,x.jsx)(eb.fQ,{className:ek().SliderTrack,children:(0,x.jsx)(eb.e6,{className:ek().SliderRange})}),(0,x.jsx)(eb.bU,{className:ek().SliderThumb,"aria-label":"Volume"})]})};var ew=i(4063),eO=i(3940),eM=i.n(eO),eS=i(8520);function eI(e){let{title:t,open:i,items:a,cancelText:s,onCancel:n,onOpenChange:r}=e,l=k((0,W.N)(e=>e.theme)),c=()=>{null==r||r(!1)};return(0,x.jsxs)(ew.fC,{open:i,children:[(0,x.jsx)(ew.xz,{asChild:!0}),(0,x.jsxs)(ew.h_,{children:[(0,x.jsx)(ew.aV,{className:I(l,eM().DialogOverlay),onClick:c}),(0,x.jsxs)(ew.VY,{className:I(l,eM().DialogContent),children:[(0,x.jsxs)("div",{children:[t&&(0,x.jsx)(ew.Dx,{className:eM().DialogTitle,children:t}),a.map(e=>(0,x.jsx)("div",{className:eM().ActionItem,"aria-disabled":!!e.disabled,onClick:async t=>{var i;!e.disabled&&(await (null===(i=e.onClick)||void 0===i?void 0:i.call(e,t))||c())},children:(0,x.jsx)("div",{children:e.label})},e.key))]}),s&&(0,x.jsx)("div",{className:eM().CancelItem,onClick:()=>{null==n||n(),c()},children:(0,x.jsx)("div",{className:eM().ActionItem,children:s})})]})]})]})}function eP(e){let{...t}=e,i=document.createElement("div");document.body.appendChild(i);let a=(0,eS.createRoot)(i),s=()=>{a.unmount()};return a.render((0,x.jsx)(eI,{...t,open:!0,onOpenChange:e=>{e||s()},onCancel:()=>{var e;null===(e=t.onCancel)||void 0===e||e.call(t),s()}})),s}var eD=i(2865),eE=i.n(eD),eT=i(9407),eA=i(978);let eF=(0,C.Ue)()((e,t)=>({canEditMusic:!1,setData:t=>{e({data:t})}}));(r=m||(m={})).OpenMusicOrder="OpenMusicOrder",r.UserMusicOrder="UserMusicOrder",r.MusicOrderDetail="MusicOrderDetail",r.Search="Search",r.Setting="Setting";let eH=(0,C.Ue)()((e,t)=>({active:"Search",setActive:(t,i)=>{if("MusicOrderDetail"===t){let{data:e,canEditMusic:t,originName:a}=i||{};eF.setState({data:e,canEditMusic:t,originName:a})}e({active:t,props:i})}})),eU=[{title:"广场",key:m.OpenMusicOrder},{title:"搜索",key:m.Search}];function eR(e){let{operateRender:t,openPage:i}=e,a=eH();return(0,x.jsxs)("div",{className:eE().header,style:{"--wails-draggable":"drag"},children:[(0,x.jsx)("div",{className:eE().logo,children:"哔哔音乐"}),(0,x.jsx)("div",{className:eE().menu,children:eU.map(e=>(0,x.jsx)("a",{className:a.active===e.key?eE().active:"",onClick:()=>{i(e.key)},children:e.title},e.key))}),(0,x.jsxs)("div",{className:eE().operate,children:[(0,x.jsx)(eT.Z,{title:"消息通知 （开发中）",className:eE().btnIcon}),(0,x.jsx)(eA.Z,{title:"系统配置",className:eE().btnIcon,onClick:()=>{i(m.Setting)}}),t]})]})}var eZ=i(439);let eB=(0,C.Ue)()((e,t)=>({list:[],load:async()=>{e({list:(await Promise.all(a.userMusicOrder.map(async e=>await e.action.getList().catch(()=>[])))).map((e,t)=>({name:a.userMusicOrder[t].name,cname:a.userMusicOrder[t].cname,list:e}))})}})),eW=(0,C.Ue)()((e,t)=>({open:!1,type:"create",form:{name:"",desc:"",cover:""},openHandler:(t,i)=>{(null==t?void 0:t.id)?e({open:!0,type:"update",form:{name:t.name,desc:t.desc||"",cover:t.cover||"",id:t.id},onOk:i}):e({open:!0,type:"update",form:{name:"",desc:"",cover:""},onOk:i})},closeHandler:()=>{e({open:!1})},setFormValue:i=>{e({form:{...t().form,...i}})}})),eV=(0,C.Ue)()((e,t)=>({open:!1,musicList:[],show:t=>{e({open:!0,musicList:Array.isArray(t)?t:[t]})},close:()=>{e({open:!1,musicList:[]})}}));function eJ(e){eV.getState().show(e)}var eq=i(9370),eG=i.n(eq),eX=i(5940);(l=h||(h={}))[l.Stop=0]="Stop",l[l.Play=1]="Play",l[l.Pause=2]="Pause",(c=p||(p={}))[c.SignalLoop=1]="SignalLoop",c[c.Random=2]="Random",c[c.ListLoop=3]="ListLoop",c[c.ListOrder=4]="ListOrder";let ez=new Map([[1,{label:"单曲循环"}],[2,{label:"随机播放"}],[3,{label:"列表循环"}],[4,{label:"顺序播放"}]]),eK="BBPlayerStorage",eY=(0,C.Ue)()((e,t)=>({audio:null,playerStatus:h.Stop,playerLoading:!1,playerList:[],playerMode:p.ListLoop,playerHistory:[],init:async()=>{eQ().then(async()=>{let e=t();if(e.current){let t=T(e.current.origin);if(!t)return;let a=await (null==t?void 0:t.action.getMusicPlayerUrl(e.current));i.setSrc(a)}});let i=a.music.createAudio();e({audio:i,playerStatus:h.Stop})},setPlayerStatus:t=>{e({playerStatus:t})},setPlayerLoading:t=>{e({playerLoading:t})},play:async i=>{var a,s,n,r,l,c;let o=t();if(o.current||e({current:o.playerList[0]}),i&&(null===(a=o.current)||void 0===a?void 0:a.id)!==i.id){(null===(s=o.playerList)||void 0===s?void 0:s.find(e=>e.id===i.id))||o.addPlayerList([i]),e({current:i,playerStatus:h.Play});let t=T(i.origin);if(!t)return;let a=await t.action.getMusicPlayerUrl(i);null===(n=o.audio)||void 0===n||n.setSrc(a),null===(r=o.audio)||void 0===r||r.setCurrentTime(0),null===(l=o.audio)||void 0===l||l.play(),o.addPlayerHistory()}else o.playerStatus===h.Play?o.pause():(e({playerStatus:h.Play}),null===(c=o.audio)||void 0===c||c.play(),o.addPlayerHistory())},pause:()=>{var i;let a=t();e({playerStatus:h.Pause}),null===(i=a.audio)||void 0===i||i.pause()},prev:()=>{var e;let i=t();if(!i.current)return;null===(e=i.audio)||void 0===e||e.setCurrentTime(0);let a=i.playerHistory.findIndex(e=>{var t;return e===(null===(t=i.current)||void 0===t?void 0:t.id)}),s=i.playerHistory[a-1];if(s){let e=i.playerList.find(e=>e.id===s);i.play(e)}},next:()=>{var e,i;let a=t();if(a.current){if(null===(e=a.audio)||void 0===e||e.setCurrentTime(0),a.playerMode===p.Random)a.endNext();else{let e=null===(i=a.playerList)||void 0===i?void 0:i.findIndex(e=>{var t;return e.id===(null===(t=a.current)||void 0===t?void 0:t.id)});if(e===a.playerList.length-1)return;a.play(a.playerList[e+1])}}},errorNext:()=>{var e,i;let a=t();if(!a.current)return;null===(e=a.audio)||void 0===e||e.setCurrentTime(0);let s=null===(i=a.playerList)||void 0===i?void 0:i.findIndex(e=>{var t;return e.id===(null===(t=a.current)||void 0===t?void 0:t.id)});s!==a.playerList.length-1&&a.play(a.playerList[s+1])},endNext:()=>{var i;let a=t(),s=a.current;if(!s)return;function n(){var e;null===(e=a.audio)||void 0===e||e.setCurrentTime(0),a.pause(),a.play(s)}if(a.playerMode===p.SignalLoop){n();return}if(a.playerMode===p.Random){let t=a.playerList.filter(e=>!a.playerHistory.includes(e.id+"")),i=t.length;if(0===i){e({playerHistory:[]});let t=a.playerList.length;a.play(a.playerList[Math.floor(Math.random()*t)])}else a.play(t[Math.floor(Math.random()*i)])}let r=null===(i=a.playerList)||void 0===i?void 0:i.findIndex(e=>{var t;return e.id===(null===(t=a.current)||void 0===t?void 0:t.id)});a.playerMode===p.ListOrder&&r!==a.playerList.length-1&&a.play(a.playerList[r+1]),a.playerMode===p.ListLoop&&(1===a.playerList.length?n():r===a.playerList.length-1?a.play(a.playerList[0]):a.play(a.playerList[r+1]))},nextPlayer:i=>{let a=Array.isArray(i)?i:[i],s=t(),n=s.current,r=s.playerList.filter(e=>!a.find(t=>t.id===e.id)),l=r.findIndex(e=>e.id===(null==n?void 0:n.id));l&&r.splice(l+1,0,i),e({playerList:r})},addPlayerList:i=>{let a=Array.isArray(i)?i:[i],s=t().playerList.filter(e=>!a.find(t=>t.id===e.id));s.push(...a),e({playerList:s})},removePlayerList:i=>{let a=t();e({playerList:a.playerList.filter(e=>!i.includes(e.id+"")),playerHistory:a.playerHistory.filter(e=>!i.includes(e))})},clearPlayerList:()=>{e({playerList:[],playerHistory:[]})},togglePlayerMode:i=>{let a=t();if(i)e({playerMode:i});else{let t=[p.SignalLoop,p.ListLoop,p.Random,p.ListOrder],i=t.findIndex(e=>a.playerMode===e);i===t.length-1?e({playerMode:t[0]}):e({playerMode:t[i+1]})}},addPlayerHistory:()=>{let i=t().current;i&&e({playerHistory:[...t().playerHistory.filter(e=>e!==i.id),i.id+""]})}}));async function eQ(){try{let e=await a.cacheStorage.getItem(eK),t=JSON.parse(e||"");eY.setState({playerList:t.playerList,playerMode:t.playerMode,current:t.current,playerHistory:t.playerHistory})}catch(e){console.log("e: ",e)}}eY.subscribe((e,t)=>{clearTimeout(n),n=setTimeout(()=>{a.cacheStorage.setItem(eK,JSON.stringify({playerList:e.playerList,playerMode:e.playerMode,current:e.current,playerHistory:e.playerHistory}))},200)});let e$="BBPlayerProgress";function e0(){let e=eY((0,W.N)(e=>({init:e.init,audio:e.audio,setPlayerStatus:e.setPlayerStatus,setPlayerLoading:e.setPlayerLoading,endNext:e.endNext,errorNext:e.errorNext,play:e.play}))),[t,i]=(0,f.useState)(0),n=(0,f.useRef)(0);return(0,f.useEffect)(()=>{e.init()},[]),(0,f.useEffect)(()=>{var t,r,l,c,o,d;(null===(t=e.audio)||void 0===t?void 0:t.addEventListener)&&((async()=>{var t;let s=Number(await a.cacheStorage.getItem(e$)),n=isNaN(s)?0:s;i(n),i(n),null===(t=e.audio)||void 0===t||t.setCurrentTime(n)})(),e.audio.addEventListener("timeupdate",async t=>{var s;let r=(null===(s=e.audio)||void 0===s?void 0:s.getCurrentTime())||0;i(r),n.current+3e3<Date.now()&&(await a.cacheStorage.setItem(e$,r.toString()),n.current=Date.now())}),null===(r=e.audio)||void 0===r||r.addEventListener("pause",()=>{e.setPlayerStatus(h.Pause)}),null===(l=e.audio)||void 0===l||l.addEventListener("play",t=>{var i;e.setPlayerStatus(h.Play);let a=null===(i=e.audio)||void 0===i?void 0:i.getReadyState();void 0!==a&&e.setPlayerLoading(4!==a)}),null===(c=e.audio)||void 0===c||c.addEventListener("ended",()=>{i(0),e.endNext()}),null===(o=e.audio)||void 0===o||o.addEventListener("error",()=>{s.error("播放失败"),i(0),e.errorNext()}),null===(d=e.audio)||void 0===d||d.addEventListener("canplay",t=>{console.log("可以播放: ",t),e.setPlayerLoading(!1)}),document.addEventListener("keydown",t=>{let i=t.target;(null==i?void 0:i.tagName.toLocaleLowerCase())!=="input"&&"Space"===t.code&&e.play()}))},[e.audio]),{currentTime:t}}var e1=i(3040),e3=i(5215);function e4(e){let{open:t}=e,i=eY();return(0,x.jsxs)("div",{className:eG().playerListContainer,style:{display:t?"":"none"},onClick:e=>{e.stopPropagation()},children:[(0,x.jsxs)("div",{className:eG().headerInfo,children:[(0,x.jsx)("div",{className:eG().title,children:"当前播放"}),(0,x.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,x.jsxs)("span",{className:eG().total,children:["总",i.playerList.length,"首"]}),(0,x.jsxs)("div",{style:{display:"flex",gap:"16px"},children:[(0,x.jsx)("span",{className:eG().operateBtn,onClick:()=>{eJ(i.playerList)},children:"收藏全部"}),(0,x.jsx)("span",{className:eG().clear,onClick:()=>{i.clearPlayerList()},children:"清空列表"})]})]})]}),(0,x.jsx)("div",{className:eG().list,children:(0,x.jsxs)(ex,{children:[(0,x.jsx)("thead",{style:{display:"none"},children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{}),(0,x.jsx)("th",{}),(0,x.jsx)("th",{})]})}),(0,x.jsx)("tbody",{children:i.playerList.map((e,t)=>{var a;return(0,x.jsx)(V,{asChild:!0,items:[{label:"播放",key:"播放",onClick:()=>{i.play(e)}},{label:"从列表中移除",key:"移除",onClick:()=>{i.removePlayerList([e.id])}},{label:"收藏到歌单",key:"收藏到歌单",onClick:()=>{eJ(e)}},{label:"下载",key:"下载",onClick:()=>{tB(e)}}],children:(0,x.jsxs)("tr",{onDoubleClick:()=>{i.play(e)},children:[(0,x.jsxs)("td",{className:I(eG().name,(null===(a=i.current)||void 0===a?void 0:a.id)===e.id&&eG().active),children:[(0,x.jsx)("div",{className:eG().icon,children:(0,x.jsx)(e1.Z,{theme:"filled",strokeWidth:2})}),(0,x.jsx)("span",{className:eG().nameText,children:e.name})]}),(0,x.jsx)("td",{children:D(e.duration)})]})},e.id)})})]})})]})}function e2(e){let{open:t,onOpenChange:i}=e,a=eY();return(0,x.jsxs)("div",{className:eG().playerListContainerForMobile,style:{display:t?"":"none"},onClick:e=>{null==i||i(!1)},children:[(0,x.jsxs)("div",{className:eG().headerInfo,onClick:()=>{null==i||i(!1)},children:[(0,x.jsxs)("div",{className:eG().title,children:["当前播放 (",a.playerList.length," 首)"]}),(0,x.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,x.jsxs)("div",{style:{display:"flex",gap:"16px"},children:[(0,x.jsx)("span",{className:eG().operateBtn,onClick:()=>{eJ(a.playerList)},children:"收藏全部"}),(0,x.jsx)("span",{className:eG().clear,onClick:()=>{a.clearPlayerList()},children:"清空列表"})]})})]}),(0,x.jsx)("div",{className:eG().list,onClick:e=>{e.stopPropagation()},children:a.playerList.map((e,t)=>{var i;return(0,x.jsxs)("div",{className:I(eG().Item,(null===(i=a.current)||void 0===i?void 0:i.id)===e.id&&eG().Active),children:[(0,x.jsx)(e1.Z,{theme:"filled",strokeWidth:2,className:eG().PlayingIcon}),(0,x.jsxs)("div",{className:eG().Info,children:[(0,x.jsx)("span",{className:eG().Name,children:e.name}),(0,x.jsxs)("div",{className:eG().Tags,children:[(0,x.jsx)("span",{children:e.origin}),(0,x.jsx)("span",{children:"\xb7"}),(0,x.jsx)("span",{children:D(e.duration)})]})]}),(0,x.jsx)("div",{className:eG().OperateList,children:(0,x.jsx)(e3.Z,{size:18,className:eG().Operate,onClick:()=>{eP({cancelText:"取消",items:[{label:"播放",key:"播放",onClick:()=>{a.play(e)}},{label:"从列表中移除",key:"移除",onClick:()=>{a.removePlayerList([e.id])}},{label:"收藏到歌单",key:"收藏到歌单",onClick:()=>{eJ(e)}},{label:"下载",key:"下载",onClick:()=>{tB(e)}}]})}})})]},e.id)})})]})}function e5(e){var t;let{progress:i}=e,a=eY((0,W.N)(e=>({current:e.current,audio:e.audio}))),s=(null===(t=a.current)||void 0===t?void 0:t.duration)||0,[n,r]=(0,f.useState)(0),l=(0,f.useRef)({mouseDown:!1});return(0,f.useEffect)(()=>{l.current.mouseDown||r(s+i===0?0:i/s*100)},[i]),(0,x.jsx)("div",{className:eG().progress,onMouseDown:e=>{l.current.mouseDown=!0},onMouseUp:e=>{var t,i;l.current.mouseDown=!1;let{width:s,left:n}=e.target.getBoundingClientRect(),c=(e.clientX-n)/s;r(100*c);let o=(null===(t=a.current)||void 0===t?void 0:t.duration)||0;null===(i=a.audio)||void 0===i||i.setCurrentTime(o*c)},onMouseMove:e=>{l.current.mouseDown},children:(0,x.jsx)("div",{className:eG().loaded,style:{width:"".concat(n,"%")},children:(0,x.jsx)("div",{className:eG().dot})})})}function e9(e){var t,i,s;let{currentTime:n,hideCover:r=!1}=e,l=eY((0,W.N)(e=>({current:e.current})));return(0,x.jsxs)("div",{className:eG().info,children:[(null===(t=l.current)||void 0===t?void 0:t.cover)&&!r&&(0,x.jsx)(Y,{src:a.utils.imgUrlTransform(l.current.cover),className:eG().cover,mode:"cover"}),(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:eG().name,children:null===(i=l.current)||void 0===i?void 0:i.name}),(0,x.jsxs)("div",{className:eG().duration,children:[(0,x.jsx)("span",{children:D(n)}),(0,x.jsx)("span",{children:"/"}),(0,x.jsx)("span",{children:D((null===(s=l.current)||void 0===s?void 0:s.duration)||0)})]})]})]})}var e6=i(8722);let e7="BBPlayerVolume";function e8(){let[e,t]=(0,f.useState)(1),i=eY(e=>({audio:e.audio})),s=(0,f.useRef)();return(0,f.useEffect)(()=>{(async()=>{var e;let s=Number(await a.cacheStorage.getItem(e7)||"1");isNaN(s)||(t(s),null===(e=i.audio)||void 0===e||e.setVolume(s))})()},[]),(0,x.jsx)(eN,{content:(0,x.jsx)("div",{style:{padding:"10px 0"},children:(0,x.jsx)(eL,{orientation:"vertical",value:[e],onValueChange:n=>{var r;let[l]=n;t(l),null===(r=i.audio)||void 0===r||r.setVolume(e),clearTimeout(s.current),s.current=setTimeout(()=>{a.cacheStorage.setItem(e7,l+"")},500)},min:0,max:1,step:.1})}),asChild:!0,children:(0,x.jsx)("button",{className:I(eG().modeIcon,eG().icon),title:"调节音量",children:(0,x.jsx)(e6.Z,{strokeWidth:3})})})}var te=i(6428),tt=i(4763),ti=i(3857),ta=i(675);function ts(e){var t;let{className:i}=e,a=eY(e=>({togglePlayerMode:e.togglePlayerMode,playerMode:e.playerMode})),s={className:i,strokeWidth:3,title:null===(t=ez.get(a.playerMode))||void 0===t?void 0:t.label,onClick:()=>{a.togglePlayerMode()}};return(0,x.jsxs)(x.Fragment,{children:[a.playerMode===p.ListLoop&&(0,x.jsx)(te.Z,{...s}),a.playerMode===p.SignalLoop&&(0,x.jsx)(tt.Z,{...s}),a.playerMode===p.Random&&(0,x.jsx)(ti.Z,{...s}),a.playerMode===p.ListOrder&&(0,x.jsx)(ta.Z,{...s})]})}var tn=i(9796),tr=i(4552),tl=i(139),tc=i(1171),to=i(125);function td(){let e=eY((0,W.N)(e=>({playerStatus:e.playerStatus,playerLoading:e.playerLoading,pause:e.pause,play:e.play})));return(0,x.jsx)(x.Fragment,{children:e.playerLoading?(0,x.jsx)(tn.Z,{theme:"filled",title:"加载中",strokeWidth:2,className:I(eG().icon,eG().play,eG().loading)}):(0,x.jsx)(x.Fragment,{children:e.playerStatus===h.Play?(0,x.jsx)(tr.Z,{theme:"filled",strokeWidth:2,className:I(eG().icon,eG().play),title:"暂停",onClick:()=>{e.pause()}}):(0,x.jsx)(tl.Z,{theme:"filled",strokeWidth:2,title:"播放",className:I(eG().icon,eG().play),onClick:()=>{e.play()}})})})}function tu(){let e=eY((0,W.N)(e=>({prev:e.prev})));return(0,x.jsx)(tc.Z,{strokeWidth:3,className:I(eG().icon),title:"上一首",onClick:()=>{e.prev()}})}function tm(){let e=eY((0,W.N)(e=>({next:e.next})));return(0,x.jsx)(to.Z,{strokeWidth:3,title:"下一首",className:I(eG().icon),onClick:()=>{e.next()}})}function th(){let e=eY((0,W.N)(e=>({audio:e.audio}))),[t,i]=(0,f.useState)(!1),{currentTime:a}=e0();return((0,f.useEffect)(()=>{let e=()=>{i(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]),e.audio)?(0,x.jsxs)("div",{className:eG().player,children:[(0,x.jsx)(e5,{progress:a}),(0,x.jsx)(e9,{currentTime:a}),(0,x.jsxs)("div",{className:eG().playerOperate,children:[(0,x.jsx)(tu,{}),(0,x.jsx)(td,{}),(0,x.jsx)(tm,{})]}),(0,x.jsxs)("div",{className:eG().operate,children:[(0,x.jsx)(e8,{}),(0,x.jsx)(ts,{className:I(eG().modeIcon,eG().icon)}),(0,x.jsx)(eX.Z,{strokeWidth:3,className:I(eG().icon,eG().musicListIcon),onClick:e=>{e.stopPropagation(),i(!t)}})]}),(0,x.jsx)(e4,{open:t})]}):null}function tp(){let e=eY(e=>({audio:e.audio})),[t,i]=(0,f.useState)(!1),{currentTime:a}=e0();return e.audio?(0,x.jsxs)("div",{className:I(eG().player,eG().playerMobile),children:[(0,x.jsx)(e5,{progress:a}),(0,x.jsx)(e9,{currentTime:a,hideCover:!0}),(0,x.jsxs)("div",{className:eG().playerOperate,children:[(0,x.jsx)(td,{}),(0,x.jsx)(tm,{}),(0,x.jsx)(ts,{className:I(eG().modeIcon,eG().icon)}),(0,x.jsx)(eX.Z,{onClick:e=>{e.stopPropagation(),i(!t)},title:"播放列表",strokeWidth:3,className:I(eG().icon)})]}),(0,x.jsx)(e2,{open:t,onOpenChange:i})]}):null}var tv=i(4751),ty=i.n(tv);function t_(e){let{extra:t,children:i}=e;return(0,x.jsxs)("div",{className:"sub-title",children:[(0,x.jsx)("div",{className:"name",children:i}),(0,x.jsx)("div",{className:"operate",children:t})]})}function tx(e){let{list:t,originName:i,gotoMusicOrderDetail:a}=e,s=eY(),n=eB(),r=eW(),l=E(i||"");return(0,x.jsx)("ul",{className:"item-list",children:t.map(e=>(0,x.jsxs)(V,{items:[{label:"播放全部",key:"播放全部",onClick:()=>{s.clearPlayerList(),s.addPlayerList(e.musicList||[]),s.play()}},{label:"追加到播放列表",key:"追加到播放列表",onClick:()=>{s.addPlayerList(e.musicList||[])}},{type:"divider",key:"divider1"},{label:"编辑",key:"2",onClick:()=>{r.openHandler(e,async e=>{let t=e.id;t&&l?await l.action.update({...e,id:t}).then(e=>{n.load()}):(console.error("id为空"),await Promise.reject(Error("id为空")))})}},{label:"删除",key:"删除",onClick:()=>{null==l||l.action.delete({...e}).then(e=>{n.load()})}}],tag:"li",className:"item",onClick:()=>{a({data:e,canEditMusic:!0,originName:i})},children:[(0,x.jsx)(eZ.Z,{className:"ui-icon",strokeWidth:3}),(0,x.jsx)("span",{className:"name",children:e.name})]},e.id))})}function tg(){let e=eW();return(0,x.jsxs)(eu,{title:"创建歌单",open:e.open,onOk:()=>{var t;null===(t=e.onOk)||void 0===t||t.call(e,e.form)},onClose:()=>{e.closeHandler()},children:[(0,x.jsx)(X,{label:"名称",children:(0,x.jsx)(ee,{value:e.form.name,onChange:t=>{e.setFormValue({name:t.target.value.trim()})}})}),(0,x.jsx)(X,{label:"描述",children:(0,x.jsx)(ee,{value:e.form.desc,onChange:t=>{e.setFormValue({desc:t.target.value.trim()})}})})]})}function tj(){let e=eB((0,W.N)(e=>({load:e.load,list:e.list}))),t=eV();return(0,x.jsx)(eu,{title:"收藏到歌单",open:t.open,onClose:()=>{t.close()},footer:(0,x.jsx)(x.Fragment,{}),children:(0,x.jsx)("div",{className:ty().MusicOrderList,children:(0,x.jsx)("div",{children:e.list.map(e=>(0,x.jsx)("div",{children:e.list.map(t=>(0,x.jsx)(tf,{data:t,originName:e.name},t.id))},e.name))})})})}function tf(e){var t;let{data:i,originName:a}=e,n=eV(),r=eB((0,W.N)(e=>({load:e.load,list:e.list}))),l=E(a||"");return(0,x.jsxs)("div",{className:ty().MusicOrderItem,onClick:()=>{n.close(),null==l||l.action.appendMusic(i.id,n.musicList).then(()=>{r.load(),s.success("已添加")})},children:[(0,x.jsx)(Y,{src:i.cover,className:ty().cover,mode:"cover"}),(0,x.jsxs)("div",{className:ty().info,children:[(0,x.jsx)("div",{className:ty().name,children:i.name}),(0,x.jsxs)("div",{className:ty().total,children:[null===(t=i.musicList)||void 0===t?void 0:t.length,"首音乐"]})]})]})}function tN(e){var t,i,a,s;let{data:n,className:r,...l}=e;return(0,x.jsxs)("div",{className:I(ty().MusicOrderItemCard,r),...l,children:[(0,x.jsx)("div",{className:ty().Cover,style:{backgroundImage:"url(".concat(n.cover,")")},children:(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:ty().Name,children:n.name}),(null===(t=n.musicList)||void 0===t?void 0:t.length)&&(0,x.jsxs)("div",{className:ty().Total,children:[null===(i=n.musicList)||void 0===i?void 0:i.length,"首"]})]})}),(0,x.jsxs)("div",{className:ty().Musics,children:[null===(a=n.musicList)||void 0===a?void 0:a.filter((e,t)=>t<3).map(e=>(0,x.jsx)("div",{children:(0,x.jsx)("span",{children:e.name})},e.id)),!(null===(s=n.musicList)||void 0===s?void 0:s.length)&&(0,x.jsx)("div",{children:"暂无歌曲"})]})]})}var tb=i(7251);function tC(e){let{gotoMusicOrderDetail:t}=e,i=eB((0,W.N)(e=>({load:e.load,list:e.list})));(0,f.useEffect)(()=>{i.load()},[]);let a=eW();return(0,x.jsxs)(x.Fragment,{children:[i.list.map(e=>(0,x.jsxs)("div",{children:[(0,x.jsx)(t_,{extra:(0,x.jsx)(tb.Z,{className:"ui-icon",title:"创建歌单",onClick:()=>{let t=E(e.name);a.openHandler(null,async e=>{await (null==t?void 0:t.action.create(e).then(e=>{i.load()}))})}}),children:e.cname}),(0,x.jsx)(tx,{list:e.list,originName:e.name,gotoMusicOrderDetail:t})]},e.name)),(0,x.jsx)(tg,{})]})}function tk(e){let{data:t,originName:i,gotoMusicOrderDetail:a}=e,s=eY(),n=eB((0,W.N)(e=>({load:e.load,list:e.list})));(0,f.useEffect)(()=>{n.load()},[]);let r=eW(),l=E(i||"");return(0,x.jsx)(tN,{data:t,onClick:()=>{eP({cancelText:"取消",items:[{label:"查看详情",key:0,onClick:()=>{a({data:t,canEditMusic:!0,originName:i})}},{label:"播放全部",key:1,onClick:()=>{s.clearPlayerList(),s.addPlayerList(t.musicList||[]),s.play()}},{label:"追加到播放列表",key:2,onClick:()=>{}},{label:"编辑",key:3,onClick:()=>{r.openHandler(t,async e=>{let t=e.id;t&&l?await l.action.update({...e,id:t}).then(e=>{n.load()}):(console.error("id为空"),await Promise.reject(Error("id为空")))})}},{label:"删除",key:4,onClick:()=>{null==l||l.action.delete({...t}).then(e=>{n.load()})}}]})}})}function tL(e){let{gotoMusicOrderDetail:t}=e;return(0,x.jsx)("div",{className:eE().sidebar,children:(0,x.jsx)(tC,{gotoMusicOrderDetail:t})})}var tw=i(7496),tO=i(7936),tM=i.n(tO);class tS{constructor(){this.openMusicOrderOrigin=[],this.userMusicOrderOrigin=[],this.musicServices=[]}}let tI=(0,C.Ue)()((e,t)=>({...new tS,load:async()=>{let t=await a.setting.getInfo();e({proxyServerPort:t.proxyServerPort,downloadDir:t.downloadDir,openMusicOrderOrigin:t.openMusicOrderOrigin||[]})}}));function tP(){let e=tI();return(0,x.jsxs)(x.Fragment,{children:[a.musicServices.map(t=>{let i=t.ConfigElement;return i?(0,x.jsxs)("div",{children:[(0,x.jsx)(tH,{title:"".concat(t.cname," 源设置")}),(0,x.jsx)(i,{onChange:()=>{e.load()}})]},t.name):null}),(0,x.jsx)("div",{className:tM().divider})]})}function tD(){var e,t;let i=tI();return a.setting.updateDownloadDir||i.proxyServerPort?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(tH,{title:"系统设置"}),a.setting.updateDownloadDir&&(0,x.jsxs)(tF,{label:"下载位置",children:[(0,x.jsx)(ee,{value:i.downloadDir,disabled:!0,readOnly:!0}),a.setting.selectDownloadDir&&(0,x.jsx)(U,{type:"link",onClick:()=>{var e,t;null===(e=(t=a.setting).selectDownloadDir)||void 0===e||e.call(t).then(e=>{if(e){var t,s;null===(t=(s=a.setting).updateDownloadDir)||void 0===t||t.call(s,e).then(()=>{i.load()})}})},children:"更改位置"})]}),(0,x.jsx)(tF,{label:"视频代理服务端口",children:(0,x.jsx)(ee,{style:{width:100},disabled:!0,readOnly:!0,value:null!==(t=null===(e=i.proxyServerPort)||void 0===e?void 0:e.toString())&&void 0!==t?t:""})}),(0,x.jsx)("div",{className:tM().divider})]}):null}class tE{constructor(){this.open=!1,this.value=""}}function tT(){let e=tI(),[t,i]=(0,f.useState)(new tE);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(tH,{title:"歌单广场源",extra:(0,x.jsxs)(U,{type:"text",onClick:()=>{i({...new tE,open:!0})},children:[(0,x.jsx)(tb.Z,{}),(0,x.jsx)("span",{children:"添加源"})]})}),e.openMusicOrderOrigin.map((e,t)=>(0,x.jsxs)(tF,{label:"广场源1",children:[(0,x.jsx)(ee,{value:e,readOnly:!0}),(0,x.jsx)(U,{type:"text",children:"删除"})]},t)),(0,x.jsx)("div",{className:tM().divider}),(0,x.jsx)(eu,{title:(0,x.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[(0,x.jsx)("span",{children:"添加歌单广场源"}),(0,x.jsx)(tw.Z,{})]}),open:t.open,onClose:()=>{i(new tE)},onOk:async()=>{let i=t.value.trim();i&&(await a.setting.updateOpenMusicOrderOrigin([...e.openMusicOrderOrigin,i]),e.load())},children:(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(ee,{placeholder:"请输入地址",value:t.value,style:{width:"100%"},onChange:e=>{i(t=>({...t,value:e.target.value}))}})})})]})}function tA(){let e=tI();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(tH,{title:"歌单同步设置"}),a.userMusicOrder.map((t,i)=>{let a=t.ConfigElement;return a?(0,x.jsxs)("div",{children:[(0,x.jsx)(tH,{title:(0,x.jsx)("span",{style:{color:"rgb(var(--main-color))"},children:t.name})}),(0,x.jsx)(a,{onChange:()=>{e.load(),eB.getState().load()}})]},i):null})]})}function tF(e){let{label:t,children:i}=e;return(0,x.jsxs)("div",{className:tM().settingItem,children:[(0,x.jsx)("label",{children:t}),(0,x.jsx)("div",{className:tM().content,children:i})]})}function tH(e){let{title:t,extra:i}=e;return(0,x.jsxs)("div",{className:tM().subTitle,children:[(0,x.jsx)("div",{className:tM().name,children:t}),(0,x.jsx)("div",{className:tM().operate,children:i})]})}let tU=(0,C.Ue)()((e,t)=>({open:!1,form:{name:""},show:(t,i,a)=>{e({open:!0,music:t,originName:a,musicOrderId:i,form:{name:t.name}})},close:()=>{e({open:!1})},setForm:i=>{e({form:{...t().form,...i}})}}));function tR(){let e=tU(),t=eB(),i=e.musicOrderId,a=e.music;return i&&a?(0,x.jsx)(eu,{title:"修改音乐信息",open:e.open,onOk:()=>{let n={...a,name:e.form.name},r=E(e.originName);null==r||r.action.updateMusic(i,n).then(()=>{t.load(),s.success("已修改")})},onClose:e.close,children:(0,x.jsx)(X,{label:"名称",children:(0,x.jsx)(ee,{value:e.form.name,onChange:t=>{e.setForm({name:t.target.value.trim()})}})})}):null}function tZ(e){let{music:t,musicOrderId:i,originName:a}=e,n=E(a);null==n||n.action.deleteMusic(i,[t]).then(()=>{eB.getState().load(),s.success("已删除")})}async function tB(e){s.success("开始下载");try{let t=T(e.origin);await (null==t?void 0:t.action.download(e)),s.success("下载成功")}catch(e){s.error((null==e?void 0:e.message)||"下载失败")}}let tW=tU.getState().show;var tV=i(1284),tJ=i.n(tV);let tq=(0,C.Ue)()((e,t)=>({list:[],load:async()=>{let t=tI.getState().openMusicOrderOrigin.map(e=>e.trim()).filter(e=>!!e),i=await Promise.all(t.map(async e=>await a.openMusicOrder.useOriginGetMusicOrder(e))),s=[];i.forEach(e=>{s.push(...e)}),e({list:s})}}));var tG=i(6445),tX=i(7646),tz=i(1744),tK=i.n(tz);function tY(){let e=eF((0,W.N)(e=>({data:e.data,canEditMusic:e.canEditMusic,originName:e.originName}))),[t,i]=(0,f.useState)(e.data),a=eB((0,W.N)(e=>e.list)),[s,n]=(0,f.useState)("");return(0,f.useEffect)(()=>{if(e.canEditMusic){var t;let s=null===(t=a.find(t=>t.name===e.originName))||void 0===t?void 0:t.list.find(t=>{var i;return t.id===(null===(i=e.data)||void 0===i?void 0:i.id)});s&&i(s)}},[e.canEditMusic,e.data,a]),{searchKeyword:s,setSearchKeyword:n,data:t,canEditMusic:e.canEditMusic,originName:e.originName}}class tQ{async update(e,t){let i={...await this.get(),[e]:t};await this.set(i)}constructor(e){this.key=e,this.get=async()=>P(await a.cacheStorage.getItem(this.key)||""),this.set=async e=>{await a.cacheStorage.setItem(this.key,JSON.stringify(e))},this.removeItem=async()=>a.cacheStorage.removeItem(this.key)}}let t$=new tQ("bb-music-search-history"),t0=(0,C.Ue)()((e,t)=>{let i=async()=>{await t1().then(t=>{e({history:t})})};return{params:{keyword:"",current:1},data:[],loading:!1,history:[],originList:[],originActive:"",init:async()=>{let t=a.musicServices.map(e=>({name:e.name,cname:e.cname}));e({originActive:t[0].name,originList:t})},load:async()=>{let a=t().params,s=t().originActive;e({loading:!0});try{let t=T(s);if(!t)return;let n={...a,keyword:a.keyword.trim()},r=await (null==t?void 0:t.action.searchList(n));t3(n.keyword).then(()=>{i()}),e({data:r.data,loading:!1,pagination:{current:r.current,total:r.total,pageSize:r.pageSize}})}catch(t){e({loading:!1})}},setParams:i=>{let a=t().params;e(()=>({params:{...a,...i}}))},loadHistoryList:async()=>{await i()},deleteHistory:async e=>{let t=(await t1()).filter(t=>t!==e);await t$.set(t),i()},clearHistory:async()=>{await t$.set([]),i()},prev:async()=>{let i=t();if(!i.pagination)return;let{current:a}=i.pagination;a&&a>1&&(e({params:{...i.params,current:a-1}}),await i.load())},next:async()=>{let i=t();if(!i.pagination)return;let{current:a,total:s,pageSize:n}=i.pagination;a&&a<s/n&&(e({params:{...i.params,current:a+1}}),await i.load())}}});async function t1(){return await t$.get()||[]}async function t3(e){let t=(await t1()).filter(t=>t!==e);t.unshift(e),t.length>40&&(t=t.splice(0,40)),await t$.set(t)}var t4=i(8393),t2=i.n(t4),t5=i(3995);function t9(){let e=t0(),t=()=>{e.params.keyword.trim()&&(e.setParams({current:1}),e.load())};return(0,f.useEffect)(()=>{e.loadHistoryList()},[]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{className:t2().searchForm,children:[(0,x.jsx)(ee,{type:"text",value:e.params.keyword,onChange:t=>{e.setParams({keyword:t.target.value})},placeholder:"请输入要搜索的歌曲名称",onKeyUp:e=>{"Enter"===e.code&&t()}}),(0,x.jsx)(U,{type:"primary",onClick:t,children:"搜索"})]}),(0,x.jsx)("div",{className:t2().searchHistory,children:e.history.map(t=>(0,x.jsxs)("div",{className:t2().item,onClick:()=>{e.setParams({keyword:t,current:1}),e.load()},children:[(0,x.jsx)("span",{children:t}),(0,x.jsx)("span",{className:t2().close,onClick:i=>{i.stopPropagation(),e.deleteHistory(t)},children:(0,x.jsx)(t5.Z,{theme:"filled"})})]},t))})]})}function t6(e){let{data:t,onDetailIsMusicOrder:i,onDetailIsMusic:a}=e,[s,n]=(0,f.useState)(!1),[r,l]=(0,f.useState)();return{loading:s,music:r,getDetailHandler:async()=>{n(!0);try{let e=T(t.origin);if(!e)return;let s=await (null==e?void 0:e.action.searchItemDetail(t));l(s),s.type===y.Order?i(s):a(s)}catch(e){console.error("e",e)}n(!1)}}}function t7(e){let{data:t,gotoMusicOrderDetail:i}=e,s=eY(),[n,r]=(0,f.useState)(!1),{loading:l,music:c,getDetailHandler:o}=t6({data:t,onDetailIsMusic:()=>{r(!0)},onDetailIsMusicOrder:e=>{i({data:e})}}),d=t.name;return(0,x.jsxs)("div",{className:t2().searchItem,onClick:o,title:d,children:[(0,x.jsx)(Y,{className:t2().cover,src:a.utils.imgUrlTransform(t.cover),alt:"",mode:"cover"}),(0,x.jsx)("div",{className:t2().title,children:(0,x.jsx)("span",{children:d})}),(0,x.jsx)("div",{className:t2().author,title:t.author,children:t.author}),(0,x.jsx)("div",{className:t2().duration,children:(0,x.jsx)("span",{children:D(t.duration)})}),l&&(0,x.jsx)("div",{className:t2().loading,children:"加载中..."}),c&&(0,x.jsxs)("div",{className:I(t2().operate,n&&t2().show),onClick:e=>{e.stopPropagation()},children:[(0,x.jsx)(U,{type:"primary",onClick:()=>{s.play(c)},children:"立即播放"}),(0,x.jsx)(U,{type:"primary",onClick:()=>{eJ(c)},children:"加入歌单"}),(0,x.jsx)(U,{type:"primary",onClick:()=>{s.addPlayerList(c)},children:"添加至播放列表"}),(0,x.jsx)(U,{type:"primary",onClick:()=>{tB(c)},children:"下载"})]})]})}function t8(e){let{data:t,gotoMusicOrderDetail:i}=e,n=eY(),{getDetailHandler:r,loading:l,music:c}=t6({data:t,onDetailIsMusic:()=>{if(!c){s.error("歌曲不存在");return}eP({cancelText:"取消",items:[{label:"立即播放",key:1,onClick:()=>{n.play(c)}},{label:"加入歌单",key:2,onClick:()=>{eJ(c)}},{label:"添加至播放列表",key:3,onClick:()=>{n.addPlayerList(c)}},{label:"下载",key:4,onClick:()=>{tB(c)}}]})},onDetailIsMusicOrder(e){i({data:e})}}),o=t.name;return(0,x.jsxs)("div",{className:I(t2().searchItem,t2().MobileSearchItem),onClick:r,title:o,children:[(0,x.jsx)(Y,{className:t2().cover,src:a.utils.imgUrlTransform(t.cover),alt:"",mode:"cover"}),(0,x.jsxs)("div",{className:t2().info,children:[(0,x.jsx)("div",{className:t2().title,children:o}),(0,x.jsxs)("div",{className:t2().tags,children:[(0,x.jsx)("span",{children:D(t.duration)}),(0,x.jsx)("span",{children:"\xb7"}),(0,x.jsx)("span",{children:t.origin}),(0,x.jsx)("span",{children:"\xb7"}),(0,x.jsx)("span",{children:t.author})]})]}),l&&(0,x.jsx)("div",{className:t2().loading,children:"加载中..."})]})}(o=v||(v={})).Bili="bili",o.YouTube="youTube",(d=y||(y={})).Music="music",d.Order="order";let ie=e=>{it(m.MusicOrderDetail,e)};function it(e,t){eH.getState().setActive(e,t)}let ii=new Map([[m.OpenMusicOrder,{Component:function(e){let{gotoMusicOrderDetail:t}=e,i=tq(),a=tI((0,W.N)(e=>e.openMusicOrderOrigin));return(0,f.useEffect)(()=>{i.load()},[a]),(0,x.jsx)("div",{className:tJ().Container,children:i.list.map(e=>(0,x.jsx)(tN,{data:e,className:tJ().Item,onClick:()=>{t({data:e})}},e.id))})},label:"广场",props:{gotoMusicOrderDetail:ie}}],[m.MusicOrderDetail,{Component:function(){var e,t;let i=eY(),{data:s,originName:n,canEditMusic:r,searchKeyword:l,setSearchKeyword:c}=tY();return s?(0,x.jsxs)("div",{className:tK().container,children:[(0,x.jsxs)("div",{className:tK().headerCard,children:[(null==s?void 0:s.cover)&&(0,x.jsx)(Y,{mode:"cover",className:tK().cover,src:a.utils.imgUrlTransform(s.cover||"")}),(0,x.jsxs)("div",{className:tK().info,children:[(0,x.jsx)("div",{className:tK().title,children:null==s?void 0:s.name}),(0,x.jsxs)("div",{className:tK().desc,children:[(0,x.jsx)("label",{children:"歌曲数"}),(0,x.jsx)("span",{children:null==s?void 0:null===(e=s.musicList)||void 0===e?void 0:e.length})]}),(0,x.jsxs)("div",{className:tK().desc,children:[(0,x.jsx)("label",{children:"描述"}),(0,x.jsx)("span",{children:(null==s?void 0:s.desc)||"-"})]}),(0,x.jsxs)("div",{className:tK().operateList,children:[(0,x.jsx)(U,{type:"primary",title:"替换当前播放列表",onClick:()=>{(null==s?void 0:s.musicList)&&(i.clearPlayerList(),i.addPlayerList(s.musicList),i.play(s.musicList[0]))},children:"播放全部"}),!r&&(0,x.jsx)(U,{onClick:()=>{var e;s&&(null===(e=s.musicList)||void 0===e?void 0:e.length)&&eJ(s.musicList||[])},children:"收藏歌单"}),(0,x.jsx)(U,{onClick:()=>{i.addPlayerList((null==s?void 0:s.musicList)||[])},children:"追加到播放列表"})]})]})]}),(0,x.jsxs)("div",{className:tK().tabHeader,children:[(0,x.jsx)("div",{className:tK().tab,children:(0,x.jsx)("div",{className:tK().active,children:"歌曲列表"})}),(0,x.jsxs)("div",{className:tK().search,children:[(0,x.jsx)(tG.Z,{}),(0,x.jsx)(ee,{placeholder:"搜索歌单音乐",onChange:e=>{c(e.target.value.trim())}})]})]}),(0,x.jsx)("div",{className:tK().musicList,children:(0,x.jsxs)(ex,{children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{style:{width:60}}),(0,x.jsx)("th",{children:"歌曲名"}),(0,x.jsx)("th",{style:{width:120},children:"操作"}),(0,x.jsx)("th",{style:{width:60},children:"时长"})]})}),(0,x.jsx)("tbody",{children:null==s?void 0:null===(t=s.musicList)||void 0===t?void 0:t.map((e,t)=>(0,x.jsx)(V,{asChild:!0,items:[{label:"播放",key:"播放",onClick:()=>{i.play(e)}},{label:"添加到播放列表",key:"添加到播放列表",onClick:()=>{i.addPlayerList(e)}},{label:"下一首播放",key:"下一首播放",onClick:()=>{i.nextPlayer(e)}},{type:"divider",key:"1"},{label:"下载",key:"下载",onClick:()=>{tB(e)}},{type:"divider",key:"2",hide:!r},{label:"修改",key:"修改",hide:!r,onClick:()=>{s&&tW(e,s.id,n)}},{type:"divider",key:"3"},{label:"收藏到歌单",key:"收藏到歌单",onClick:()=>{eJ(e)}},{label:"从歌单中删除",key:"从歌单中删除",onClick:()=>{let t=null==s?void 0:s.id;if(!t||!n)return null;tZ({musicOrderId:t,music:e,originName:n})}}],children:(0,x.jsxs)("tr",{style:{display:e.name.includes(l)?"":"none"},onDoubleClick:()=>{i.play(e)},children:[(0,x.jsx)("td",{children:t+1}),(0,x.jsx)("td",{className:tK().name,title:e.name,children:e.name}),(0,x.jsx)("td",{style:{cursor:"pointer"},title:"下载",onClick:()=>{tB(e)},children:(0,x.jsx)(tX.Z,{})}),(0,x.jsx)("td",{children:D(e.duration)})]},e.id)},e.id))})]})})]}):null},label:"歌单详情"}],[m.Search,{Component:function(e){var t;let{gotoMusicOrderDetail:i}=e,a=t0();return(0,f.useEffect)(()=>{a.init()},[]),(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(t9,{}),(0,x.jsxs)("div",{className:t2().searchList,children:[null===(t=a.data)||void 0===t?void 0:t.map(e=>(0,x.jsx)(t7,{data:e,gotoMusicOrderDetail:i},e.id)),a.pagination&&(0,x.jsxs)("div",{className:t2().pagination,children:[(0,x.jsx)("span",{onClick:()=>{a.prev()},children:"上一页"}),(0,x.jsx)("span",{onClick:()=>{a.next()},children:"下一页"})]})]})]})},label:"搜索",props:{gotoMusicOrderDetail:ie}}],[m.Setting,{Component:function(){let e=tI();return(0,f.useEffect)(()=>{e.load()},[]),(0,x.jsxs)("div",{className:tM().container,style:{"--input-default-width":"460px"},children:[(0,x.jsx)(tD,{}),(0,x.jsx)(tP,{}),(0,x.jsx)(tT,{}),(0,x.jsx)(tA,{}),a.setting.ExtraElement]})},label:"设置"}]]);function ia(e){let{className:t,style:i,header:a,headerProps:s}=e,n=k((0,W.N)(e=>e.theme)),r=tI((0,W.N)(e=>e.load));return(0,f.useEffect)(()=>{r()},[]),(0,x.jsxs)("div",{className:I(eE().container,"".concat(H,"-container"),t,n),style:i,children:[(0,x.jsx)(es,{}),!a&&(0,x.jsx)(eR,{...s,openPage:it}),(0,x.jsxs)("main",{className:eE().main,children:[(0,x.jsx)(tL,{gotoMusicOrderDetail:e=>{ie(e)}}),(0,x.jsx)(is,{})]}),(0,x.jsx)(th,{}),(0,x.jsx)(tj,{}),(0,x.jsx)(tR,{})]})}function is(){let{active:e,props:t}=eH((0,W.N)(e=>({active:e.active,props:e.props}))),i=(0,f.useMemo)(()=>{var i,a;let s=null===(i=ii.get(e))||void 0===i?void 0:i.Component,n=null===(a=ii.get(e))||void 0===a?void 0:a.props;return s?(0,x.jsx)(s,{...t,...n}):null},[e]);return(0,x.jsx)("div",{className:eE().content,children:i})}var ir=i(4946),il=i.n(ir);let ic=[{title:"广场",key:m.OpenMusicOrder},{title:"搜索",key:m.Search},{title:"我的",key:m.UserMusicOrder},{title:"设置",key:m.Setting}];function io(e){let{openPage:t}=e,i=eH();return(0,x.jsx)("div",{className:il().header,style:{"--wails-draggable":"drag"},children:(0,x.jsx)("div",{className:il().menu,children:ic.map(e=>(0,x.jsx)("a",{className:i.active===e.key?il().active:"",onClick:()=>{t(e.key)},children:e.title},e.key))})})}let id=e=>{iu(m.MusicOrderDetail,e)};function iu(e,t){eH.getState().setActive(e,t)}let im=new Map([[m.OpenMusicOrder,{Component:function(e){let{gotoMusicOrderDetail:t}=e,i=tq(),a=tI((0,W.N)(e=>e.openMusicOrderOrigin));return(0,f.useEffect)(()=>{i.load()},[a]),(0,x.jsx)("div",{className:tJ().ContainerForMobile,children:i.list.map(e=>(0,x.jsx)(tN,{data:e,className:tJ().ItemForMobile,onClick:()=>{t({data:e})}},e.id))})},label:"广场",props:{gotoMusicOrderDetail:id}}],[m.UserMusicOrder,{Component:function(e){let{gotoMusicOrderDetail:t}=e,i=eB((0,W.N)(e=>({load:e.load,list:e.list})));(0,f.useEffect)(()=>{i.load()},[]);let a=eW();return(0,x.jsxs)("div",{className:ty().MusicOrderListFormMobile,children:[i.list.map(e=>(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:ty().OriginHeader,children:[(0,x.jsx)("div",{children:e.cname}),(0,x.jsx)(tb.Z,{className:ty().CreateBtn,title:"创建歌单",onClick:()=>{let t=E(e.name);a.openHandler(null,async e=>{await (null==t?void 0:t.action.create(e).then(e=>{i.load()}))})}})]}),e.list.map(i=>(0,x.jsx)("div",{className:ty().List,children:(0,x.jsx)(tk,{data:i,originName:e.name,gotoMusicOrderDetail:t})},i.id))]},e.name)),(0,x.jsx)(tg,{})]})},label:"广场",props:{gotoMusicOrderDetail:id}}],[m.MusicOrderDetail,{Component:function(){var e,t;let i=eY(),{data:s,originName:n,canEditMusic:r,searchKeyword:l,setSearchKeyword:c}=tY();return s?(0,x.jsxs)("div",{className:I(tK().container,tK().MobileContainer),children:[(0,x.jsx)("div",{className:tK().MusicOrderInfo,style:{backgroundImage:"url(".concat(a.utils.imgUrlTransform(s.cover||""),")")},children:(0,x.jsxs)("div",{className:tK().info,children:[(0,x.jsx)("div",{className:tK().title,children:null==s?void 0:s.name}),(0,x.jsxs)("div",{className:tK().desc,children:[(0,x.jsx)("label",{children:"歌曲数"}),(0,x.jsx)("span",{children:null==s?void 0:null===(e=s.musicList)||void 0===e?void 0:e.length})]}),(0,x.jsxs)("div",{className:tK().desc,children:[(0,x.jsx)("label",{children:"描述"}),(0,x.jsx)("span",{children:(null==s?void 0:s.desc)||"-"})]})]})}),(0,x.jsxs)("div",{className:tK().operateList,children:[(0,x.jsx)(U,{type:"primary",title:"替换当前播放列表",onClick:()=>{(null==s?void 0:s.musicList)&&(i.clearPlayerList(),i.addPlayerList(s.musicList),i.play(s.musicList[0]))},children:"播放全部"}),!r&&(0,x.jsx)(U,{onClick:()=>{var e;s&&(null===(e=s.musicList)||void 0===e?void 0:e.length)&&eJ(s.musicList||[])},children:"收藏歌单"}),(0,x.jsx)(U,{onClick:()=>{i.addPlayerList((null==s?void 0:s.musicList)||[])},children:"追加到播放列表"})]}),(0,x.jsx)("div",{className:tK().searchMusic,children:(0,x.jsx)(ee,{placeholder:"搜索歌单音乐",onChange:e=>{c(e.target.value.trim())}})}),(0,x.jsx)("div",{className:tK().musicList,children:null==s?void 0:null===(t=s.musicList)||void 0===t?void 0:t.map((e,t)=>(0,x.jsxs)("div",{className:tK().MusicItem,style:{display:e.name.includes(l)?"":"none"},onClick:()=>{i.play(e)},children:[(0,x.jsx)("div",{className:tK().Index,children:t+1}),(0,x.jsxs)("div",{className:tK().MusicInfo,children:[(0,x.jsx)("div",{className:tK().Name,children:e.name}),(0,x.jsxs)("div",{className:tK().Tags,children:[(0,x.jsx)("span",{children:D(e.duration)}),(0,x.jsx)("span",{children:"\xb7"}),(0,x.jsx)("span",{children:e.origin})]})]}),(0,x.jsx)("div",{className:tK().Operate,onClick:t=>{t.stopPropagation(),eP({cancelText:"取消",items:[{label:"播放",key:"播放",onClick:()=>{i.play(e)}},{label:"添加到播放列表",key:"添加到播放列表",onClick:()=>{i.addPlayerList(e)}},{label:"下一首播放",key:"下一首播放",onClick:()=>{i.nextPlayer(e)}},{label:"下载",key:"下载",onClick:()=>{tB(e)}},{label:"修改",disabled:!r,key:"修改",onClick:()=>{s&&tW(e,s.id,n)}},{label:"收藏到歌单",key:"收藏到歌单",onClick:()=>{eJ(e)}},{label:"从歌单中删除",disabled:!r,key:"从歌单中删除",onClick:()=>{let t=null==s?void 0:s.id;if(!t||!n)return null;tZ({musicOrderId:t,music:e,originName:n})}}]})},children:(0,x.jsx)(e3.Z,{})})]},e.id))})]}):null},label:"歌单详情"}],[m.Search,{Component:function(e){var t;let{gotoMusicOrderDetail:i}=e,a=t0();return(0,f.useEffect)(()=>{a.init()},[]),(0,x.jsxs)("div",{className:t2().MobileSearchPage,children:[(0,x.jsx)(t9,{}),(0,x.jsxs)("div",{className:t2().searchList,children:[null===(t=a.data)||void 0===t?void 0:t.map(e=>(0,x.jsx)(t8,{data:e,gotoMusicOrderDetail:i},e.id)),a.pagination&&(0,x.jsxs)("div",{className:t2().pagination,children:[(0,x.jsx)("span",{onClick:()=>{a.prev()},children:"上一页"}),(0,x.jsx)("span",{onClick:()=>{a.next()},children:"下一页"})]})]})]})},label:"搜索",props:{gotoMusicOrderDetail:id}}],[m.Setting,{Component:function(){let e=tI();return(0,f.useEffect)(()=>{e.load()},[]),(0,x.jsxs)("div",{className:tM().ContainerForMobile,style:{"--input-default-width":"100%"},children:[(0,x.jsx)(tD,{}),(0,x.jsx)(tP,{}),(0,x.jsx)(tT,{}),(0,x.jsx)(tA,{}),a.setting.ExtraElement]})},label:"设置"}]]);function ih(e){let{className:t,style:i}=e,a=k((0,W.N)(e=>e.theme)),s=tI((0,W.N)(e=>e.load));return(0,f.useEffect)(()=>{s(),ed=!0},[]),(0,x.jsxs)("div",{className:I(il().container,"".concat(H,"-container"),t,a),style:i,children:[(0,x.jsx)(io,{openPage:iu}),(0,x.jsx)(ip,{}),(0,x.jsx)(tp,{}),(0,x.jsx)(tj,{}),(0,x.jsx)(es,{}),(0,x.jsx)(tR,{})]})}function ip(){let{active:e,props:t}=eH((0,W.N)(e=>({active:e.active,props:e.props}))),i=(0,f.useMemo)(()=>{var i,a;let s=null===(i=im.get(e))||void 0===i?void 0:i.Component,n=null===(a=im.get(e))||void 0===a?void 0:a.props;return s?(0,x.jsx)(s,{...t,...n}):null},[e]);return(0,x.jsx)("div",{className:il().main,children:i})}var iv=i(4279);class iy{async update(e,t){let i={...await this.get(),[e]:t};await this.set(i)}constructor(e){this.key=e,this.get=async()=>(function(e){try{return JSON.parse(e)}catch(e){}})(await (0,iv.U2)(this.key)),this.set=async e=>{await (0,iv.t8)(this.key,JSON.stringify(e))},this.removeItem=async()=>{await (0,iv.IV)(this.key)}}}var i_=i(3618);async function ix(e){let{proxy:t}=e;return await (0,i_.Z)({...t}).then(e=>e.data.data)}class ig{constructor(){this.useOriginGetMusicOrder=async e=>await ix({proxy:{url:"/api/open-music-order",params:{origin:e}}})}}class ij{setCurrentTime(e){this.ctx.currentTime=e}getReadyState(){return this.ctx.readyState}getCurrentTime(){return this.ctx.currentTime}setSrc(e){this.ctx.src=e}play(){this.ctx.play()}pause(){this.ctx.pause()}getVolume(){return this.ctx.volume}setVolume(e){this.ctx.volume=e}constructor(){this.ctx=new Audio,this.addEventListener=(e,t)=>{this.ctx.addEventListener(e,t)},this.removeEventListener=(e,t)=>{this.ctx.removeEventListener(e,t)};let e="BB_MUSIC_AUDIO",t=document.getElementById(e);if(t){this.ctx=t;return}let i=new Audio;i.style.display="none",i.id=e,this.ctx=i,document.body.append(i),navigator.mediaSession&&(i.addEventListener("play",()=>{let e=eY.getState().current;navigator.mediaSession.playbackState="playing",e&&(navigator.mediaSession.metadata=new MediaMetadata({title:e.name,artist:"",album:"",artwork:[{src:e.cover||""}]}))}),i.addEventListener("pause",()=>{navigator.mediaSession.playbackState="paused"}),navigator.mediaSession.setActionHandler("nexttrack",()=>{eY.getState().next()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{eY.getState().prev()}),navigator.mediaSession.setActionHandler("play",()=>{eY.getState().play()}),navigator.mediaSession.setActionHandler("pause",()=>{eY.getState().pause()}))}}class iN{createAudio(){return new ij}}class ib{constructor(){this.imgUrlTransform=e=>{let t;return(t=e).startsWith("https://")||t.startsWith("http://")||(t="http:"+t),"https://image.baidu.com/search/down?url=".concat(t)}}}(u=_||(_={})).ExtendClass="ExtendClass",u.Github="Github";var iC=i(1237),ik=i(309);class iL{async getDataAndRsa(e){try{return await this.getData(e)}catch(t){if(404===t.response.status)return await this.createMyJson(e),await this.getData(e);return await Promise.reject(t)}}createConfig(e){let{owner:t,repo:i}=function(e){let[,,,t,i]=e.split("/");return{owner:t,repo:e.endsWith(".git")?i.replace(/\.git/gi,""):i}}(e.repo),a="/repos/".concat(t,"/").concat(i,"/contents/my.json");return{request:i_.Z.create({baseURL:"https://api.github.com",headers:{Authorization:"Bearer ".concat(e.token),"X-GitHub-Api-Version":"2022-11-28",Accept:"application/vnd.github+json"}}),filePath:a}}async getData(e){let{request:t,filePath:i}=this.createConfig(e),a=await t.get(i);return{data:P(ik.DS.decode(a.data.content))||[],sha:a.data.sha}}async createMyJson(e){let{request:t,filePath:i}=this.createConfig(e),a=ik.DS.atob("[]");await t.put(i,{message:"初始化歌单文件",content:a})}async updateItem(e,t,i,a){let{request:s,filePath:n}=this.createConfig(t),r=await this.getDataAndRsa(t),l=r.data,c=l.find(t=>t.id===e);if(!c)return await Promise.reject(Error("歌单不存在"));l=l.map(t=>t.id===e?{...t,...i(t),updated_at:O()().format()}:t);let o=ik.DS.encode(JSON.stringify(l));await s.put(n,{message:a(c),content:o,sha:r.sha})}constructor(e){this.getConfig=e,this.getList=async()=>{let e=await this.getConfig(),t=[];try{t=(await this.getData(e)).data}catch(i){404===i.response.status&&(await this.createMyJson(e),t=(await this.getData(e)).data)}return t},this.create=async e=>{let t=await this.getConfig(),{request:i,filePath:a}=this.createConfig(t),s=await this.getDataAndRsa(t),n=s.data;if(n.find(t=>t.name===e.name)){await Promise.reject(Error("歌单已存在"));return}let r=(0,iC.x0)();n.push({id:r,name:e.name,desc:e.desc,cover:e.cover,musicList:e.musicList,created_at:O()().format(),updated_at:""});let l=ik.DS.encode(JSON.stringify(n));await i.put(a,{message:"创建歌单".concat(e.name,"(").concat(r,")"),content:l,sha:s.sha})},this.update=async e=>{let t=await this.getConfig();await this.updateItem(e.id,t,()=>({name:e.name,desc:e.desc,cover:e.cover}),e=>"更新歌单".concat(e.name,"(").concat(e.id,")"))},this.delete=async e=>{let t=await this.getConfig(),{request:i,filePath:a}=this.createConfig(t),s=await this.getDataAndRsa(t),n=s.data,r=n.find(t=>t.id===e.id);if(!r){await Promise.reject(Error("歌单不存在"));return}n=n.filter(t=>t.id!==e.id);let l=ik.DS.encode(JSON.stringify(n));await i.put(a,{message:"删除歌单".concat(r.name,"(").concat(r.id,")"),content:l,sha:s.sha})},this.getDetail=async e=>(await this.getList()).find(t=>t.id===e)||await Promise.reject(Error("歌单不存在")),this.appendMusic=async(e,t)=>{let i=await this.getConfig();await this.updateItem(e,i,e=>{var i;return{musicList:[...(null===(i=e.musicList)||void 0===i?void 0:i.filter(e=>!t.find(t=>t.id===e.id)))||[],...t]}},()=>"新增歌曲")},this.updateMusic=async(e,t)=>{let i=await this.getConfig();await this.updateItem(e,i,e=>{var i;return{musicList:(null===(i=e.musicList)||void 0===i?void 0:i.map(e=>e.id===t.id?{...e,name:t.name,cover:t.cover}:e))||[]}},()=>"修改歌曲信息")},this.deleteMusic=async(e,t)=>{let i=await this.getConfig();await this.updateItem(e,i,e=>{var i;return{musicList:(null===(i=e.musicList)||void 0===i?void 0:i.filter(e=>!t.map(e=>e.id).includes(e.id)))||[]}},()=>"移除歌曲")}}}let iw=_.Github;class iO{constructor(e,t){this.settingCache=e,this.updateUserMusicOrderOriginConfig=t,this.name=iw,this.cname="Github 歌单",this.ConfigElement=e=>{let{onChange:t}=e,[i,a]=(0,f.useState)({repo:"",token:""}),n=async()=>{let e=await this.settingCache.get();if(e){var t;let i=null===(t=e.userMusicOrderOrigin.find(e=>e.name===iw))||void 0===t?void 0:t.config;i&&a({repo:i.repo,token:i.token})}};(0,f.useEffect)(()=>{n()},[]);let r=(e,t)=>{a({...i,[e]:t})};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(tF,{label:"仓库地址",children:(0,x.jsx)(ee,{value:i.repo,onChange:e=>{r("repo",e.target.value)}})}),(0,x.jsx)(tF,{label:"token",children:(0,x.jsx)(ee,{value:i.token,onChange:e=>{r("token",e.target.value)}})}),(0,x.jsx)(U,{onClick:()=>{this.updateUserMusicOrderOriginConfig(iw,i).then(()=>{null==t||t(i),s.success("已保存")})},children:"保存"})]})},this.action=new iL(async()=>{var e;let t=await this.settingCache.get();return null==t?void 0:null===(e=t.userMusicOrderOrigin.find(e=>e.name===iw))||void 0===e?void 0:e.config})}}class iM{constructor(){this.userLocalMusicOrderCache=new iy("bb-music-local-order"),this.getList=async()=>{var e;return null!==(e=await this.userLocalMusicOrderCache.get())&&void 0!==e?e:[]},this.create=async e=>{let t=await this.getList();if(t.find(t=>t.name.trim()===e.name.trim())){await Promise.reject(Error("歌单名称重复"));return}await this.userLocalMusicOrderCache.set([{...e,id:(0,iC.x0)()},...t])},this.update=async e=>{await this.updateItem(e.id,()=>({name:e.name,desc:e.desc,cover:e.cover}))},this.delete=async e=>{let t=await this.getList();await this.userLocalMusicOrderCache.set(t.filter(t=>t.id!==e.id))},this.getDetail=async e=>(await this.getList()).find(t=>t.id===e)||await Promise.reject(Error("歌单不存在")),this.appendMusic=async(e,t)=>{await this.updateItem(e,e=>{var i;let a=null===(i=e.musicList)||void 0===i?void 0:i.filter(e=>!t.find(t=>t.id===e.id));return{musicList:[...null!=a?a:[],...t]}})},this.updateMusic=async(e,t)=>{await this.updateItem(e,e=>{var i;let a=null===(i=e.musicList)||void 0===i?void 0:i.map(e=>e.id===t.id?{...e,name:t.name,cover:t.cover}:e);return{musicList:null!=a?a:[]}})},this.deleteMusic=async(e,t)=>{await this.updateItem(e,e=>{var i;return{musicList:(null===(i=e.musicList)||void 0===i?void 0:i.filter(e=>!t.map(e=>e.id).includes(e.id)))||[]}})},this.updateItem=async(e,t)=>{let i=await this.getList();await this.userLocalMusicOrderCache.set(i.map(i=>i.id===e?{...i,...t(i),updated_at:O()().format()}:i))}}}class iS{constructor(){this.name="Local",this.cname="本地歌单",this.action=new iM}}class iI{constructor(){this.settingCache=new iy("bb-setting"),this.getInfo=async()=>{var e;return{...await this.settingCache.get()||{openMusicOrderOrigin:[],musicServices:[]},userMusicOrderOrigin:(null===(e=a.userMusicOrder)||void 0===e?void 0:e.map(e=>({name:e.name,config:{}})))||[]}},this.updateOpenMusicOrderOrigin=async e=>{await this.settingCache.update("openMusicOrderOrigin",e)},this.updateUserMusicOrderOrigin=async e=>{await this.settingCache.update("userMusicOrderOrigin",e)}}}async function iP(e){let{proxy:t}=e,i=await iR();return(await (0,i_.Z)({...t,headers:{...t.headers,bili_spi_b3:i.spi_data.b_3,bili_spi_b4:i.spi_data.b_4,bili_sign_img_key:i.sign_data.img_key,bili_sign_sub_key:i.sign_data.sub_key}})).data.data}let iD="bili";class iE{constructor(){this.enabled=!0,this.proxyEnabled=!1,this.proxyAddress="",this.proxyToken=""}}let iT="bili";class iA{constructor(e){this.name=iT,this.cname="哔哩哔哩",this.action=new iF,this.hooks=new iH,this.ConfigElement=function(e){let{getSetting:t,updateMusicServicesSetting:i}=e;return e=>{let{onChange:a}=e,[n,r]=(0,f.useState)(),[l,c]=(0,f.useState)(new iE),o=async()=>{let e=iU();r(e||void 0),e&&t().then(e=>{if(Array.isArray(null==e?void 0:e.musicServices)){var t,i;c(null==e?void 0:null===(i=e.musicServices)||void 0===i?void 0:null===(t=i.find(e=>e.name===iD))||void 0===t?void 0:t.config)}})};(0,f.useEffect)(()=>{o()},[]);let d=(e,t)=>({[t?"checked":"value"]:l[e],onChange:i=>{c(a=>({...a,[e]:t?i:i.target.value}))}});return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(tF,{label:"开启/关闭",children:(0,x.jsx)(ev,{...d("enabled",!0)})}),(0,x.jsxs)("div",{style:{display:l.enabled?"block":"none"},children:[(0,x.jsx)(tF,{label:"代理开启/关闭",children:(0,x.jsx)(ev,{...d("proxyEnabled",!0)})}),(0,x.jsxs)("div",{style:{display:l.proxyEnabled?"block":"none"},children:[(0,x.jsx)(tF,{label:"代理地址",children:(0,x.jsx)(ee,{...d("proxyAddress")})}),(0,x.jsx)(tF,{label:"代理秘钥",children:(0,x.jsx)(ee,{...d("proxyToken")})})]}),(0,x.jsxs)("div",{style:{display:l.proxyEnabled?"none":"block"},children:[(0,x.jsx)(tF,{label:"imgKey",children:(0,x.jsx)(ee,{value:null==n?void 0:n.sign_data.img_key,disabled:!0})}),(0,x.jsx)(tF,{label:"subKey",children:(0,x.jsx)(ee,{value:null==n?void 0:n.sign_data.img_key,disabled:!0})}),(0,x.jsx)(tF,{label:"UUID_V3",children:(0,x.jsx)(ee,{value:null==n?void 0:n.spi_data.b_3,disabled:!0})}),(0,x.jsx)(tF,{label:"UUID_V4",children:(0,x.jsx)(ee,{value:null==n?void 0:n.spi_data.b_4,disabled:!0})})]})]}),(0,x.jsx)("div",{style:{marginBottom:15,display:"flex",gap:"15px"},children:(0,x.jsx)(U,{onClick:()=>{i(iD,l).then(()=>{null==a||a(l),s.success("已保存")})},children:"保存"})})]})}}(e)}}class iF{constructor(){this.searchList=async e=>{let t={page:(e.current||1)+"",keyword:e.keyword},i=await iP({proxy:{url:"/api/search/".concat(iT),params:t}});return{...i,data:i.data.map(e=>({...e,name:function(e){let t=document.createElement("div");return t.innerHTML=e,t.innerText}(e.name),cover:e.cover,type:e.type}))}},this.searchItemDetail=async e=>{let t=await iP({proxy:{url:"/api/search/".concat(iT,"/").concat(e.id)}});return{...t,type:t.type}},this.getMusicPlayerUrl=async e=>"/api/music/file/".concat(iT,"/").concat(e.id),this.download=async e=>{let t=document.createElement("a");t.href="/api/music/file/".concat(iT,"/").concat(e.id),t.download="".concat(e.name,".mp4"),t.target="_blank",t.click()}}}class iH{constructor(){this.init=async()=>{await iR()}}}function iU(){let e=window.localStorage.getItem("bili_auth_config");return!!e&&function(e){try{return JSON.parse(e)}catch(e){}}(e)}async function iR(){let e=iU();if(e&&1>O()().diff(O()(e.created_at),"hour"))return console.log("cache"),e;let t={...(await i_.Z.get("/api/config/".concat(iT))).data.data,created_at:O()().format()};return window.localStorage.setItem("bili_auth_config",JSON.stringify(t)),Object.entries({bili_spi_b3:t.spi_data.b_3,bili_spi_b4:t.spi_data.b_4,bili_sign_img_key:t.sign_data.img_key,bili_sign_sub_key:t.sign_data.sub_key}).forEach(e=>{let[t,i]=e;(function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,a="";if(i){let e=new Date;e.setTime(e.getTime()+864e5*i),a="; expires="+e.toUTCString()}document.cookie=e+"="+(t||"")+a+"; path=/"})(t,i)}),t}let iZ=new iI,iB={utils:new ib,cacheStorage:{getItem:async e=>await (0,iv.U2)(e)||"",setItem:async(e,t)=>{await (0,iv.t8)(e,t)},removeItem:async e=>{await (0,iv.IV)(e)}},setting:iZ,music:new iN,openMusicOrder:new ig,userMusicOrder:[new iS,new iO(iZ.settingCache,iW)],musicServices:[new iA({getSetting:iZ.settingCache.get,updateMusicServicesSetting:iV})]};async function iW(e,t){var i;let a=await iZ.settingCache.get(),s=null!==(i=null==a?void 0:a.userMusicOrderOrigin)&&void 0!==i?i:[];s.find(t=>t.name===e)?s=s.map(i=>(i.name===e&&(i.config=t),i)):s.push({name:e,config:t}),await iZ.settingCache.update("userMusicOrderOrigin",s)}async function iV(e,t){var i;let a=await iZ.settingCache.get(),s=null!==(i=null==a?void 0:a.musicServices)&&void 0!==i?i:[];s.find(t=>t.name===e)?s=s.map(i=>(i.name===e&&(i.config=t),i)):s.push({name:e,config:t}),iZ.settingCache.update("musicServices",s)}function iJ(){let[e,t]=(0,f.useState)(!1),[i,a]=(0,f.useState)(),s=async()=>{t(!0);try{console.log("INIT SERVICE HOOK"),await Promise.all(iB.musicServices.map(async e=>{var t,i;return await (null===(i=e.hooks)||void 0===i?void 0:null===(t=i.init)||void 0===t?void 0:t.call(i))}))}catch(e){console.log("error: ",e)}t(!1)};return((0,f.useEffect)(()=>{a(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(window.navigator.userAgent)),s()},[]),void 0===i)?null:(0,x.jsx)("div",{style:{width:"100vw",height:"100%",overflow:"hidden",boxSizing:"border-box"},children:!e&&(0,x.jsx)(L,{apiInstance:iB,children:i?(0,x.jsx)(ih,{}):(0,x.jsx)(ia,{})})})}function iq(){return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(j(),{children:[(0,x.jsx)("title",{children:"哔哔音乐"}),(0,x.jsx)("meta",{name:"description",content:"免费，免登陆，在线畅听全网音乐"}),(0,x.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,x.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,x.jsx)(iJ,{})]})}},3940:function(e){e.exports={DialogOverlay:"actionSheet_DialogOverlay__YUT1P",overlayShow:"actionSheet_overlayShow__sLqoR",DialogContent:"actionSheet_DialogContent__gV4ug",contentShow:"actionSheet_contentShow__5tS2o",ActionItem:"actionSheet_ActionItem__aD1Qg",CancelItem:"actionSheet_CancelItem__h5pBq",DialogTitle:"actionSheet_DialogTitle__8sC1D",DialogDescription:"actionSheet_DialogDescription__YDAsI"}},5833:function(e){e.exports={btn:"button_btn__b8R5N",primary:"button_primary__FFBIj",link:"button_link__jQjIu",text:"button_text__SqUUi"}},3371:function(e){e.exports={menu:"contextMenu_menu__u_4LK",item:"contextMenu_item__STc_F",arrow:"contextMenu_arrow__BMn91",divider:"contextMenu_divider__lEgj9"}},7959:function(e){e.exports={formItem:"form_formItem__48t7T"}},3158:function(e){e.exports={img:"image_img__SX09i"}},4911:function(e){e.exports={input:"input_input__ObitG"}},5129:function(e){e.exports={ToastViewport:"message_ToastViewport__Uqk1q",ToastRoot:"message_ToastRoot__fq_IT",slideIn:"message_slideIn__z4hyW",hide:"message_hide__F3FxY",swipeOut:"message_swipeOut__QyHNO",ToastTitle:"message_ToastTitle__536Hr",ToastDescription:"message_ToastDescription__lLJa4",ToastAction:"message_ToastAction__HXSDn"}},3923:function(e){e.exports={modalContainer:"modal_modalContainer__WjMtd",modal:"modal_modal__w5bbf",header:"modal_header__C3qVO",title:"modal_title__QYch9",close:"modal_close___m55L",body:"modal_body__w9EgZ",footer:"modal_footer__tfDvW",modalContainerForMobile:"modal_modalContainerForMobile__5QChu"}},6916:function(e){e.exports={PopoverContent:"popover_PopoverContent__vS7jh",Arrow:"popover_Arrow__rARWo",slideDownAndFade:"popover_slideDownAndFade__mZNgs",slideLeftAndFade:"popover_slideLeftAndFade__vWNti",slideUpAndFade:"popover_slideUpAndFade__a91Z8",slideRightAndFade:"popover_slideRightAndFade__7Cc8D",PopoverClose:"popover_PopoverClose__X4FHX",IconButton:"popover_IconButton__ZjRU_",Fieldset:"popover_Fieldset__62WI1",Label:"popover_Label__mEFaG",Input:"popover_Input__5cx8W",Text:"popover_Text__EmNlH"}},4670:function(e){e.exports={SliderRoot:"slider_SliderRoot__6plJE",SliderTrack:"slider_SliderTrack__4gBCm",SliderRange:"slider_SliderRange__fL90G",SliderThumb:"slider_SliderThumb__Efcmx"}},3352:function(e){e.exports={SwitchRoot:"switch_SwitchRoot__advOM",SwitchThumb:"switch_SwitchThumb__t2a76"}},6133:function(e){e.exports={table:"table_table__7qU6w",active:"table_active__SZpus"}},4946:function(e){e.exports={container:"Mobile_container__jKnYL",header:"Mobile_header__lLOtb",menu:"Mobile_menu__miKDJ",active:"Mobile_active__DkT82",main:"Mobile_main__mOkD3",content:"Mobile_content__nMx_7"}},2865:function(e){e.exports={container:"Pc_container__6lmyF",header:"Pc_header__N4dvU",logo:"Pc_logo__3FRnf",menu:"Pc_menu__FKPun",active:"Pc_active__HCtsO",operate:"Pc_operate__rX3qy",btnIcon:"Pc_btnIcon__8GdH1",main:"Pc_main__RchpK",content:"Pc_content__3k_84",sidebar:"Pc_sidebar___UmWE"}},1744:function(e){e.exports={headerCard:"musicOrderDetail_headerCard__TJTE1",cover:"musicOrderDetail_cover__0kScm",info:"musicOrderDetail_info__OW_h_",title:"musicOrderDetail_title__RL_Yn",operateList:"musicOrderDetail_operateList__45MOa",desc:"musicOrderDetail_desc__O__I_",tabHeader:"musicOrderDetail_tabHeader__uJ5Cy",search:"musicOrderDetail_search__BswOO",active:"musicOrderDetail_active__O7dxz",musicList:"musicOrderDetail_musicList__gE2Ep",name:"musicOrderDetail_name__ptALh",MobileContainer:"musicOrderDetail_MobileContainer__Ga2mU",MusicOrderInfo:"musicOrderDetail_MusicOrderInfo__RV_Mv",searchMusic:"musicOrderDetail_searchMusic__lcgWu",MusicItem:"musicOrderDetail_MusicItem__TDE6p",Index:"musicOrderDetail_Index__WI_bO",MusicInfo:"musicOrderDetail_MusicInfo__Xh7gf",Name:"musicOrderDetail_Name__BiOOq",Tags:"musicOrderDetail_Tags___GnS_",Operate:"musicOrderDetail_Operate__mF9eo"}},4751:function(e){e.exports={MusicOrderList:"musicOrderList_MusicOrderList__nK0uZ",MusicOrderSubTitle:"musicOrderList_MusicOrderSubTitle__KMCNh",MusicOrderItem:"musicOrderList_MusicOrderItem__irdsW",cover:"musicOrderList_cover__jzGnV",name:"musicOrderList_name__pr2LU",total:"musicOrderList_total__2p2ij",MusicOrderListFormMobile:"musicOrderList_MusicOrderListFormMobile__TinAf",OriginHeader:"musicOrderList_OriginHeader__3BM_b",CreateBtn:"musicOrderList_CreateBtn__ZvvK1",MusicOrderItemCard:"musicOrderList_MusicOrderItemCard__oyTYA",Cover:"musicOrderList_Cover__Hci62",Total:"musicOrderList_Total__648Oa",Musics:"musicOrderList_Musics____vBE"}},1284:function(e){e.exports={Container:"openMusicOrder_Container__3Ozj0",Item:"openMusicOrder_Item__RMejz",ContainerForMobile:"openMusicOrder_ContainerForMobile__k35IN",ItemForMobile:"openMusicOrder_ItemForMobile__KQ1Ny"}},9370:function(e){e.exports={player:"player_player__Ux8rL",progress:"player_progress__QeZLe",loaded:"player_loaded___Q0H7",dot:"player_dot__44NTh",info:"player_info__PyfDu",cover:"player_cover__AxX1M",duration:"player_duration__paplW",name:"player_name___rLEl",playerOperate:"player_playerOperate__VhPmr",play:"player_play__SaWEy",loading:"player_loading__ZA36f",rotateLoop:"player_rotateLoop__1ueEP",icon:"player_icon__euVcU",operate:"player_operate__lveDe",playerListContainer:"player_playerListContainer__vDhLC",headerInfo:"player_headerInfo__gsULA",title:"player_title___L4cK",total:"player_total__XMcXc",operateBtn:"player_operateBtn__AFeRs",clear:"player_clear__GCfRu",list:"player_list__sIBxZ",nameText:"player_nameText__xOWpC",active:"player_active__c4Ajd",playerListContainerForMobile:"player_playerListContainerForMobile__0jpMZ",Item:"player_Item__G5QES",Active:"player_Active__MG2Y0",PlayingIcon:"player_PlayingIcon__sHHqv",Name:"player_Name__6Pevr",Info:"player_Info__rA_22",OperateList:"player_OperateList__xS_nu",Operate:"player_Operate__CZWP5",Tags:"player_Tags__5arDE",playerMobile:"player_playerMobile__i_0IW"}},8393:function(e){e.exports={searchList:"search_searchList__qfcfi",searchItem:"search_searchItem__SXSPN",cover:"search_cover__gSIYB",info:"search_info__JyBAQ",title:"search_title__wYMOh",duration:"search_duration__9vDdh",author:"search_author__nHdWA",tags:"search_tags___uFPT",loading:"search_loading__A_XFJ",operate:"search_operate__LoW0q",show:"search_show__ynN7X",pagination:"search_pagination__N6Huf",searchForm:"search_searchForm__Nf_hh",searchHistory:"search_searchHistory__j4lel",item:"search_item__1nqbl",close:"search_close__vhJrq",MobileSearchPage:"search_MobileSearchPage__sJGVX",MobileSearchItem:"search_MobileSearchItem__dYDl_"}},7936:function(e){e.exports={container:"setting_container__nqyLm",ContainerForMobile:"setting_ContainerForMobile__aSLPM",subTitle:"setting_subTitle__QmaOy",name:"setting_name__qeQCt",operate:"setting_operate__x6p6x",operateItem:"setting_operateItem__pOykK",settingItem:"setting_settingItem__Gwq4y",content:"setting_content__cBhsh",operateBtn:"setting_operateBtn__iRbvn",divider:"setting_divider__VKSP2",aboutLink:"setting_aboutLink___LrUm"}},3525:function(e){e.exports={dark:"dark_dark__6uoie"}}},function(e){e.O(0,[786,888,774,179],function(){return e(e.s=74)}),_N_E=e.O()}]);